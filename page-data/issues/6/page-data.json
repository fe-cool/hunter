{
    "componentChunkName": "component---src-templates-issues-tsx",
    "path": "/issues/6",
    "result": {"data":{"issuesJson":{"id":"a64e924b-e1ff-50b7-8dc5-5cb5ccf06768","title":"å®ç°ä¸€ä¸ªä¸²è¡Œè¯·æ±‚é˜Ÿåˆ—","number":6,"bodyHTML":"<h2 dir=\"auto\">é—®é¢˜æè¿°</h2>\n\n\n<p dir=\"auto\">å¯¹äºå¼‚æ­¥è¯·æ±‚<code class=\"notranslate\">ajaxN</code>ï¼Œå…¶ä¸­<code class=\"notranslate\">N</code>ä»£è¡¨<code class=\"notranslate\">è¯·æ±‚çš„æ‰§è¡Œæ—¶é—´</code>ï¼Œå¦‚<code class=\"notranslate\">ajax1</code>ä»£è¡¨<code class=\"notranslate\">è¯·æ±‚1ç§’åè¿”å›</code>ã€‚</p>\n<p dir=\"auto\">å®ç°ä¸€ä¸ªä¸²è¡Œè¯·æ±‚é˜Ÿåˆ—<code class=\"notranslate\">serial</code>å‡½æ•°ï¼Œæ¥æ”¶<code class=\"notranslate\">åŒ…å«å¼‚æ­¥è¯·æ±‚çš„æ•°ç»„</code>ï¼ŒæŒ‰é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</p>\n<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"const ajaxArr: Ajax[] = [ajax1, ajax2, ajax4];\n\nfunction serial(ajaxArr: Ajax[]) {\n  // å®ç°...\n}\n\nserial(ajaxArr)\n// 1ç§’åajax1è¯·æ±‚å®Œæ¯•\n// å†è¿‡2ç§’ï¼Œajax2è¯·æ±‚å®Œæ¯•\n// å†è¿‡4ç§’ï¼Œajax4è¯·æ±‚å®Œæ¯•\"><pre class=\"notranslate\"><span class=\"pl-k\">const</span> <span class=\"pl-s1\">ajaxArr</span>: <span class=\"pl-v\">Ajax</span><span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-s1\">ajax1</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">ajax2</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">ajax4</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n\n<span class=\"pl-k\">function</span> <span class=\"pl-en\">serial</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">ajaxArr</span>: <span class=\"pl-v\">Ajax</span><span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-c\">// å®ç°...</span>\n<span class=\"pl-kos\">}</span>\n\n<span class=\"pl-en\">serial</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">ajaxArr</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\">// 1ç§’åajax1è¯·æ±‚å®Œæ¯•</span>\n<span class=\"pl-c\">// å†è¿‡2ç§’ï¼Œajax2è¯·æ±‚å®Œæ¯•</span>\n<span class=\"pl-c\">// å†è¿‡4ç§’ï¼Œajax4è¯·æ±‚å®Œæ¯•</span></pre></div>\n<p dir=\"auto\">è¯·ç»™å‡ºä½ çš„<code class=\"notranslate\">å®ç°æ–¹æ³•</code>å’Œ<code class=\"notranslate\">æ–‡å­—æè¿°</code></p>\n<h2 dir=\"auto\">æœ€ä½³ç­”æ¡ˆ</h2>\n<p dir=\"auto\">ç®€æ´çš„ç­”æ¡ˆï¼š<a href=\"https://github.com/BetaSu/fe-hunter/issues/6#issuecomment-1075827760\" data-hovercard-type=\"issue\" data-hovercard-url=\"/BetaSu/fe-hunter/issues/6/hovercard\">fightZyçš„å›ç­”</a><br>\nå®Œå¤‡çš„ç­”æ¡ˆï¼š<a href=\"https://github.com/BetaSu/fe-hunter/issues/6#issuecomment-1076140316\" data-hovercard-type=\"issue\" data-hovercard-url=\"/BetaSu/fe-hunter/issues/6/hovercard\">codingJJJçš„å›ç­”</a></p>\n<h3 dir=\"auto\">ç­”é¢˜åŒå­¦é¡»çŸ¥</h3>\n<p dir=\"auto\">æœ€ä½³ç­”æ¡ˆç”±<code class=\"notranslate\">å›´è§‚åŒå­¦</code>çš„<code class=\"notranslate\">ğŸ‘</code>å’Œ<a href=\"https://github.com/BetaSu\">å¡é¢‚</a>å…±åŒå†³å®šã€‚<strong>éç­”é¢˜ç›¸å…³è¯„è®º</strong>ä¼šè¢«åˆ é™¤ï¼Œé—®é¢˜ç›¸å…³å†…å®¹è®¨è®ºè¯·åœ¨<a href=\"https://github.com/BetaSu/fe-hunter\">èµé‡‘çŒäººç¾¤</a>é‡Œè®¨è®º</p>\n<h3 dir=\"auto\">å›´è§‚åŒå­¦é¡»çŸ¥</h3>\n<p dir=\"auto\">å¯¹äºä½ æ»¡æ„çš„ç­”æ¡ˆï¼Œè¯·ä¸è¦åæƒœä½ çš„<code class=\"notranslate\">ğŸ‘</code>ï¼Œè¿™æ˜¯è¯„é€‰<strong>æœ€ä½³ç­”æ¡ˆ</strong>çš„æ ‡å‡†</p>","updatedAt":"2022-03-24T09:45:32Z","upvoteCount":null,"author":{"login":"BetaSu","avatarUrl":"https://avatars.githubusercontent.com/u/15828041?u=3b08cdf9f9b49dbead9ffb020a94d925904d2b74&v=4","url":"https://github.com/BetaSu"},"category":null,"labels":{"edges":[{"node":{"name":"JS","color":"ffee58"}},{"node":{"name":"åŠ¨æ‰‹","color":"42a5f5"}}]},"comments":{"edges":[{"node":{"id":"IC_kwDOHCfdf85AH8M3","bodyHTML":"<ol dir=\"auto\">\n<li>ä¸»è¦æ€è·¯é€šè¿‡Promise.raceæ¥ç«é€Ÿï¼Œç”±äºæ­¤é¢˜æ˜¯åªæœ‰ä¸€ä¸ªåœ¨æ‰§è¡Œï¼Œé‚£ä¹ˆåªéœ€è¦å•ä¸ªæ‰§è¡Œå³å¯</li>\n<li>ä½¿ç”¨Promise.raceçš„å¥½å¤„æ˜¯ï¼Œä»¥åæ‰©å±•ä¸ºåŒæ—¶2ä¸ªï¼Œ3 ä¸ªã€‚ã€‚ã€‚ã€‚ç­‰ç­‰æ‰§è¡Œï¼Œéƒ½å¯ä»¥ä½¿ç”¨æ­¤å®ç°</li>\n</ol>\n<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"function excuteTask(task: string){\n  // å–å‡ºæ‰§è¡Œæ—¶é—´\n  const time = task.substr(task.length - 1, 1);\n  // é€šè¿‡Promiseçš„ç‰¹æ€§ï¼Œç»“åˆå®šæ—¶å™¨ï¼Œæ¨¡æ‹Ÿajaxæ‰§è¡Œæ—¶é—´\n  return new Promise((res, rej) =&gt; {\n    console.log(`${task} start`);\n    setTimeout(() =&gt; {\n      console.log(`${task} end`);\n      res();\n    }, time * 1000);\n  });\n}\n\nfunction serial(ajaxArr: Ajax[]){\n  // è¿™é‡Œä½¿ç”¨concatï¼Œæ˜¯ä¸ºäº†æ‹·è´ä¸€ä»½æ•°æ®æºï¼Œé˜²æ­¢åç»­æ“ä½œå½±å“åˆ°æ•°æ®æº\n  const queue = [].concat(ajaxArr);\n  let promises = [];\n // å› ä¸ºæ˜¯æŒ‰é˜Ÿåˆ—æ‰§è¡Œï¼Œé‚£ä¹ˆè¿™é‡Œåªéœ€è¦ä¸€ä¸ªä¸€ä¸ªæˆªå–å³å¯\n  promises = queue.splice(0, 1).map((task, index) =&gt; {\n    // è¿™é‡Œé€šè¿‡æ¨¡æ‹Ÿæ‰§è¡Œå‡½æ•°ï¼Œè¿”å›å½“å‰æ‰§è¡Œçš„ajaxçš„ç´¢å¼•ï¼Œä¸ºäº†ä¹‹åæ‰§è¡Œæ—¶èƒ½æ­£ç¡®æ‰¾åˆ°æ‰§è¡Œå‡½æ•°\n    return excuteTask(task).then(() =&gt; {\n      return index;\n    });\n  });\n  // é€šè¿‡race,ç«é€Ÿ\n  let p = Promise.race(promises); \n  for(let i = 0; i &lt; queue.length; i ++){\n    // è¿™é‡Œå°±ç”¨åˆ°ä¹‹å‰è¿”å›çš„ç´¢å¼•ï¼Œå½“æ‰§è¡Œå®Œæˆä¸€ä¸ªåï¼Œä¸æ–­æ›´æ”¹ç«é€Ÿé˜Ÿåˆ—\n    p = p.then(res =&gt; {\n      promises[res] = excuteTask(queue[i]).then(() =&gt; {\n        return res;\n      });\n      return Promise.race(promises);\n    });\n  }\n}\n\"><pre class=\"notranslate\"><span class=\"pl-k\">function</span> <span class=\"pl-en\">excuteTask</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">task</span>: <span class=\"pl-s1\">string</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">{</span>\n  <span class=\"pl-c\">// å–å‡ºæ‰§è¡Œæ—¶é—´</span>\n  <span class=\"pl-k\">const</span> <span class=\"pl-s1\">time</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">task</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">substr</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">task</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">length</span> <span class=\"pl-c1\">-</span> <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n  <span class=\"pl-c\">// é€šè¿‡Promiseçš„ç‰¹æ€§ï¼Œç»“åˆå®šæ—¶å™¨ï¼Œæ¨¡æ‹Ÿajaxæ‰§è¡Œæ—¶é—´</span>\n  <span class=\"pl-k\">return</span> <span class=\"pl-k\">new</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">res</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">rej</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">`<span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">task</span><span class=\"pl-kos\">}</span></span> start`</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-en\">setTimeout</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">`<span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">task</span><span class=\"pl-kos\">}</span></span> end`</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-s1\">res</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">time</span> <span class=\"pl-c1\">*</span> <span class=\"pl-c1\">1000</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n  <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n<span class=\"pl-kos\">}</span>\n\n<span class=\"pl-k\">function</span> <span class=\"pl-en\">serial</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">ajaxArr</span>: <span class=\"pl-v\">Ajax</span><span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">{</span>\n  <span class=\"pl-c\">// è¿™é‡Œä½¿ç”¨concatï¼Œæ˜¯ä¸ºäº†æ‹·è´ä¸€ä»½æ•°æ®æºï¼Œé˜²æ­¢åç»­æ“ä½œå½±å“åˆ°æ•°æ®æº</span>\n  <span class=\"pl-k\">const</span> <span class=\"pl-s1\">queue</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">concat</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">ajaxArr</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n  <span class=\"pl-k\">let</span> <span class=\"pl-s1\">promises</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n <span class=\"pl-c\">// å› ä¸ºæ˜¯æŒ‰é˜Ÿåˆ—æ‰§è¡Œï¼Œé‚£ä¹ˆè¿™é‡Œåªéœ€è¦ä¸€ä¸ªä¸€ä¸ªæˆªå–å³å¯</span>\n  <span class=\"pl-s1\">promises</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">queue</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">splice</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">0</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">map</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">task</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">index</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-c\">// è¿™é‡Œé€šè¿‡æ¨¡æ‹Ÿæ‰§è¡Œå‡½æ•°ï¼Œè¿”å›å½“å‰æ‰§è¡Œçš„ajaxçš„ç´¢å¼•ï¼Œä¸ºäº†ä¹‹åæ‰§è¡Œæ—¶èƒ½æ­£ç¡®æ‰¾åˆ°æ‰§è¡Œå‡½æ•°</span>\n    <span class=\"pl-k\">return</span> <span class=\"pl-en\">excuteTask</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">task</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">then</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-k\">return</span> <span class=\"pl-s1\">index</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n  <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n  <span class=\"pl-c\">// é€šè¿‡race,ç«é€Ÿ</span>\n  <span class=\"pl-k\">let</span> <span class=\"pl-s1\">p</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">race</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">promises</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span> \n  <span class=\"pl-k\">for</span><span class=\"pl-kos\">(</span><span class=\"pl-k\">let</span> <span class=\"pl-s1\">i</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">0</span><span class=\"pl-kos\">;</span> <span class=\"pl-s1\">i</span> <span class=\"pl-c1\">&lt;</span> <span class=\"pl-s1\">queue</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">length</span><span class=\"pl-kos\">;</span> <span class=\"pl-s1\">i</span> <span class=\"pl-c1\">++</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">{</span>\n    <span class=\"pl-c\">// è¿™é‡Œå°±ç”¨åˆ°ä¹‹å‰è¿”å›çš„ç´¢å¼•ï¼Œå½“æ‰§è¡Œå®Œæˆä¸€ä¸ªåï¼Œä¸æ–­æ›´æ”¹ç«é€Ÿé˜Ÿåˆ—</span>\n    <span class=\"pl-s1\">p</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">p</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">then</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">res</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-s1\">promises</span><span class=\"pl-kos\">[</span><span class=\"pl-s1\">res</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">excuteTask</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">queue</span><span class=\"pl-kos\">[</span><span class=\"pl-s1\">i</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">then</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-k\">return</span> <span class=\"pl-s1\">res</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-k\">return</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">race</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">promises</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n  <span class=\"pl-kos\">}</span>\n<span class=\"pl-kos\">}</span></pre></div>","author":{"login":"CrownNight","avatarUrl":"https://avatars.githubusercontent.com/u/32128133?u=66c2ce393bf2a726f320227300e8bbc7ff3f6957&v=4","url":"https://github.com/CrownNight"},"replies":null}},{"node":{"id":"IC_kwDOHCfdf85AH8Ov","bodyHTML":"<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"let request = (url) =&gt; {\n    return new Promise((resolve, reject) =&gt; {\n        let sec = url.match(/[0-9]/g).join();\n        setTimeout(function() {\n\t    resolve(url)\n        }, sec * 1000);\n    })\n}\n\nlet serial = async (list) =&gt; {\n    let result = [];\n    for(let i=0; i&lt;list.length; i++) {\n        res = await request(list[i]);\n        console.log(res);\n        result.push(res);\n    }\n    console.log(result);\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">let</span> <span class=\"pl-en\">request</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">url</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-k\">return</span> <span class=\"pl-k\">new</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">resolve</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">reject</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-k\">let</span> <span class=\"pl-s1\">sec</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">url</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">match</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\"><span class=\"pl-c1\">/</span><span class=\"pl-kos\">[</span>0-9<span class=\"pl-kos\">]</span><span class=\"pl-c1\">/</span>g</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">join</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-en\">setTimeout</span><span class=\"pl-kos\">(</span><span class=\"pl-k\">function</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n\t    <span class=\"pl-s1\">resolve</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">url</span><span class=\"pl-kos\">)</span>\n        <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">sec</span> <span class=\"pl-c1\">*</span> <span class=\"pl-c1\">1000</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-kos\">}</span>\n\n<span class=\"pl-k\">let</span> <span class=\"pl-en\">serial</span> <span class=\"pl-c1\">=</span> <span class=\"pl-k\">async</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">list</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-k\">let</span> <span class=\"pl-s1\">result</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-k\">for</span><span class=\"pl-kos\">(</span><span class=\"pl-k\">let</span> <span class=\"pl-s1\">i</span><span class=\"pl-c1\">=</span><span class=\"pl-c1\">0</span><span class=\"pl-kos\">;</span> <span class=\"pl-s1\">i</span><span class=\"pl-c1\">&lt;</span><span class=\"pl-s1\">list</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">length</span><span class=\"pl-kos\">;</span> <span class=\"pl-s1\">i</span><span class=\"pl-c1\">++</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-s1\">res</span> <span class=\"pl-c1\">=</span> <span class=\"pl-k\">await</span> <span class=\"pl-en\">request</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">list</span><span class=\"pl-kos\">[</span><span class=\"pl-s1\">i</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">res</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-s1\">result</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">push</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">res</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-kos\">}</span>\n    <span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">result</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n<span class=\"pl-kos\">}</span></pre></div>","author":{"login":"chanchunlei","avatarUrl":"https://avatars.githubusercontent.com/u/34532433?u=bf1081ac39accac1030a2a4f8f93bf74913f419b&v=4","url":"https://github.com/chanchunlei"},"replies":null}},{"node":{"id":"IC_kwDOHCfdf85AH8vT","bodyHTML":"<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"function serial(tasks) {\n  const t = tasks\n  const next = () =&gt; {\n      const task = t.shift()\n      if (task) {\n        return Promise.resolve(task).then(() =&gt; {\n          return next()\n        })    \n      } else {\n          return Promise.resolve('done')\n      }\n    }\n \n   return   next() \n}\"><pre class=\"notranslate\"><span class=\"pl-k\">function</span> <span class=\"pl-en\">serial</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">tasks</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-k\">const</span> <span class=\"pl-s1\">t</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">tasks</span>\n  <span class=\"pl-k\">const</span> <span class=\"pl-en\">next</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-k\">const</span> <span class=\"pl-s1\">task</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">shift</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-k\">if</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">task</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-k\">return</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">resolve</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">task</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">then</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n          <span class=\"pl-k\">return</span> <span class=\"pl-en\">next</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span>\n        <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span>    \n      <span class=\"pl-kos\">}</span> <span class=\"pl-k\">else</span> <span class=\"pl-kos\">{</span>\n          <span class=\"pl-k\">return</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">resolve</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'done'</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-kos\">}</span>\n    <span class=\"pl-kos\">}</span>\n \n   <span class=\"pl-k\">return</span>   <span class=\"pl-en\">next</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> \n<span class=\"pl-kos\">}</span></pre></div>","author":{"login":"lz-lee","avatarUrl":"https://avatars.githubusercontent.com/u/22316795?u=191a8fcf9eb1d7c149eb869acec9f36c58df3732&v=4","url":"https://github.com/lz-lee"},"replies":null}},{"node":{"id":"IC_kwDOHCfdf85AH9Qw","bodyHTML":"<ul dir=\"auto\">\n<li>\n<p dir=\"auto\">å‡è®¾æ‰§è¡Œajaxè¿”å›çš„éƒ½æ˜¯promise</p>\n<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"function serial(ajaxArr) {\n return ajaxArr.reduce((pre, cur) =&gt; pre.then(() =&gt; cur()), Promise.resolve())\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">function</span> <span class=\"pl-en\">serial</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">ajaxArr</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n <span class=\"pl-k\">return</span> <span class=\"pl-s1\">ajaxArr</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">reduce</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">pre</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">cur</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s1\">pre</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">then</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s1\">cur</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">resolve</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-kos\">}</span></pre></div>\n</li>\n</ul>","author":{"login":"fightZy","avatarUrl":"https://avatars.githubusercontent.com/u/52490455?u=4a008fd4e5a82484f5eec0f82487368910fc9f65&v=4","url":"https://github.com/fightZy"},"replies":null}},{"node":{"id":"IC_kwDOHCfdf85AH9VD","bodyHTML":"<p dir=\"auto\">åº”è¯¥<code class=\"notranslate\">reduce</code>å°±èƒ½è§£å†³ï¼ŸMDNæœ‰ç›¸åŒçš„ä»£ç ç¤ºä¾‹ï¼š<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce#running_promises_in_sequence\" rel=\"nofollow\">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce#running_promises_in_sequence</a></p>\n<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"function runPromiseInSequence(arr, input) {\n  return arr.reduce(\n    (promiseChain, currentFunction) =&gt; promiseChain.then(currentFunction),\n    Promise.resolve(input)\n  )\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">function</span> <span class=\"pl-en\">runPromiseInSequence</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">arr</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">input</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-k\">return</span> <span class=\"pl-s1\">arr</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">reduce</span><span class=\"pl-kos\">(</span>\n    <span class=\"pl-kos\">(</span><span class=\"pl-s1\">promiseChain</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">currentFunction</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s1\">promiseChain</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">then</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">currentFunction</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span>\n    <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">resolve</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">input</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-kos\">)</span>\n<span class=\"pl-kos\">}</span></pre></div>","author":{"login":"wood3n","avatarUrl":"https://avatars.githubusercontent.com/u/31716713?u=b8b5fc87885be46078a2d2f96676f1d938396f87&v=4","url":"https://github.com/wood3n"},"replies":null}},{"node":{"id":"IC_kwDOHCfdf85AH9zV","bodyHTML":"<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"function serial(arr) {\n  var sequence = Promise.resolve()\n  arr.forEach(function (item) {\n   sequence = sequence.then(item)\n  })\n  return sequence\n }\"><pre class=\"notranslate\"><span class=\"pl-k\">function</span> <span class=\"pl-en\">serial</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">arr</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-k\">var</span> <span class=\"pl-s1\">sequence</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">resolve</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-s1\">arr</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">forEach</span><span class=\"pl-kos\">(</span><span class=\"pl-k\">function</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">item</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n   <span class=\"pl-s1\">sequence</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">sequence</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">then</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">item</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">return</span> <span class=\"pl-s1\">sequence</span>\n <span class=\"pl-kos\">}</span></pre></div>","author":{"login":"HSQCoollaughing","avatarUrl":"https://avatars.githubusercontent.com/u/29752874?u=b98f84939d984f739d0fd06928963b744419d4de&v=4","url":"https://github.com/HSQCoollaughing"},"replies":null}},{"node":{"id":"IC_kwDOHCfdf85AIE9H","bodyHTML":"<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"/**\n * @description å€ŸåŠ© async\n *\n * åŸç†ï¼š async æ˜¯ promise + generator çš„è¯­æ³•ç³–ï¼Œgenerator æä¾›äº†ä¸²è¡Œçš„èƒ½åŠ›\n */\nasync function serialByAsync(ajaxArr) {\n  const result = [];\n\n  for (let i = 0; i &lt; ajaxArr.length; i++) {\n    const ajax = ajaxArr[i];\n    try {\n      const res = await ajax();\n      result.push(res);\n    } catch (error) {\n      result.push(error);\n    }\n  }\n\n  return result;\n}\"><pre class=\"notranslate\"><span class=\"pl-c\">/**</span>\n<span class=\"pl-c\"> * <span class=\"pl-k\">@description</span> å€ŸåŠ© async</span>\n<span class=\"pl-c\"> *</span>\n<span class=\"pl-c\"> * åŸç†ï¼š async æ˜¯ promise + generator çš„è¯­æ³•ç³–ï¼Œgenerator æä¾›äº†ä¸²è¡Œçš„èƒ½åŠ›</span>\n<span class=\"pl-c\"> */</span>\n<span class=\"pl-k\">async</span> <span class=\"pl-k\">function</span> <span class=\"pl-en\">serialByAsync</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">ajaxArr</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-k\">const</span> <span class=\"pl-s1\">result</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n\n  <span class=\"pl-k\">for</span> <span class=\"pl-kos\">(</span><span class=\"pl-k\">let</span> <span class=\"pl-s1\">i</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">0</span><span class=\"pl-kos\">;</span> <span class=\"pl-s1\">i</span> <span class=\"pl-c1\">&lt;</span> <span class=\"pl-s1\">ajaxArr</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">length</span><span class=\"pl-kos\">;</span> <span class=\"pl-s1\">i</span><span class=\"pl-c1\">++</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-k\">const</span> <span class=\"pl-s1\">ajax</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">ajaxArr</span><span class=\"pl-kos\">[</span><span class=\"pl-s1\">i</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-k\">try</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-k\">const</span> <span class=\"pl-s1\">res</span> <span class=\"pl-c1\">=</span> <span class=\"pl-k\">await</span> <span class=\"pl-s1\">ajax</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-s1\">result</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">push</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">res</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-kos\">}</span> <span class=\"pl-k\">catch</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">error</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-s1\">result</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">push</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">error</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-kos\">}</span>\n  <span class=\"pl-kos\">}</span>\n\n  <span class=\"pl-k\">return</span> <span class=\"pl-s1\">result</span><span class=\"pl-kos\">;</span>\n<span class=\"pl-kos\">}</span></pre></div>","author":{"login":"yearth","avatarUrl":"https://avatars.githubusercontent.com/u/12742400?u=0a6e6f05ecb3b00661fd1f04b2ecce8dd4249534&v=4","url":"https://github.com/yearth"},"replies":null}},{"node":{"id":"IC_kwDOHCfdf85AILH8","bodyHTML":"<p dir=\"auto\">å¦‚æœå¸Œæœ›åœ¨ä½¿ç”¨çš„æ—¶å€™,å¯ä»¥å®æ—¶æ‹¿åˆ°ä»»åŠ¡è¿”å›çš„å€¼,å¯ä»¥é€šè¿‡å°è£…æˆå¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°,ä½¿ç”¨ <code class=\"notranslate\">for await...of</code> è¯­æ³•è®¿é—®,æ¯å½“æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡æ—¶,å°±èƒ½æ‹¿åˆ°å¯¹åº”çš„è¿”å›å€¼,è€Œä¸éœ€è¦ç­‰å¾…æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ‰èƒ½è·å–åˆ°å€¼.</p>\n<blockquote>\n<p dir=\"auto\">æ¯”å¦‚æƒ³è¦æ˜¾ç¤ºä»»åŠ¡è¿›åº¦çš„æ—¶å€™,å¯ä»¥æ ¹æ®ä»»åŠ¡æ‰§è¡Œçš„æƒ…å†µ,æ¯æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡æ—¶,å®æ—¶æ›´æ–°è¿›åº¦</p>\n</blockquote>\n<p dir=\"auto\">å®ç°å¦‚ä¸‹:</p>\n<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"async function *serial(tasks) {\n    for (let task of tasks) {\n        yield await task()\n    }\n}\n\nvoid async function() {\n    let sleep = (i)=&gt;new Promise(r=&gt;setTimeout(()=&gt;r(i), i))\n\n    const tasks = [()=&gt;sleep(1000), ()=&gt;sleep(2000), ()=&gt;sleep(4000)]\n\n    let start = new Date().valueOf(), i = 1\n    for await(let res of serial(tasks)) {\n        const time = Math.round((new Date().valueOf() - start) / 1000)\n\n        console.log(`ç¬¬ ${time} ç§’ç¬¬ ${i++} ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆ,è¿”å›: ${res}`)\n    }\n}()\n\"><pre class=\"notranslate\"><span class=\"pl-k\">async</span> <span class=\"pl-k\">function</span> <span class=\"pl-c1\">*</span><span class=\"pl-s1\">serial</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">tasks</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-k\">for</span> <span class=\"pl-kos\">(</span><span class=\"pl-k\">let</span> <span class=\"pl-s1\">task</span> <span class=\"pl-k\">of</span> <span class=\"pl-s1\">tasks</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-k\">yield</span> <span class=\"pl-k\">await</span> <span class=\"pl-en\">task</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-kos\">}</span>\n<span class=\"pl-kos\">}</span>\n\n<span class=\"pl-k\">void</span> <span class=\"pl-k\">async</span> <span class=\"pl-k\">function</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-k\">let</span> <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">i</span><span class=\"pl-kos\">)</span><span class=\"pl-c1\">=&gt;</span><span class=\"pl-k\">new</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">r</span><span class=\"pl-c1\">=&gt;</span><span class=\"pl-en\">setTimeout</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-c1\">=&gt;</span><span class=\"pl-en\">r</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">i</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">i</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n\n    <span class=\"pl-k\">const</span> <span class=\"pl-s1\">tasks</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-c1\">=&gt;</span><span class=\"pl-en\">sleep</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">1000</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-c1\">=&gt;</span><span class=\"pl-en\">sleep</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">2000</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-c1\">=&gt;</span><span class=\"pl-en\">sleep</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">4000</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">]</span>\n\n    <span class=\"pl-k\">let</span> <span class=\"pl-s1\">start</span> <span class=\"pl-c1\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-v\">Date</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">valueOf</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">i</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">1</span>\n    <span class=\"pl-k\">for</span> <span class=\"pl-k\">await</span><span class=\"pl-kos\">(</span><span class=\"pl-k\">let</span> <span class=\"pl-s1\">res</span> <span class=\"pl-k\">of</span> <span class=\"pl-en\">serial</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">tasks</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-k\">const</span> <span class=\"pl-s1\">time</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Math</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">round</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-k\">new</span> <span class=\"pl-v\">Date</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">valueOf</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">-</span> <span class=\"pl-s1\">start</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">/</span> <span class=\"pl-c1\">1000</span><span class=\"pl-kos\">)</span>\n\n        <span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">`ç¬¬ <span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">time</span><span class=\"pl-kos\">}</span></span> ç§’ç¬¬ <span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">i</span><span class=\"pl-c1\">++</span><span class=\"pl-kos\">}</span></span> ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆ,è¿”å›: <span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">res</span><span class=\"pl-kos\">}</span></span>`</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-kos\">}</span>\n<span class=\"pl-kos\">}</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span></pre></div>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/38753204/159620149-194d2b78-9563-4464-b173-2147612bc736.png\"><img src=\"https://user-images.githubusercontent.com/38753204/159620149-194d2b78-9563-4464-b173-2147612bc736.png\" alt=\"2022-03-23_11-48-07\" style=\"max-width: 100%;\"></a></p>","author":{"login":"XYShaoKang","avatarUrl":"https://avatars.githubusercontent.com/u/38753204?u=5c9caf75f64b7d41fff6081a665226890f518153&v=4","url":"https://github.com/XYShaoKang"},"replies":null}},{"node":{"id":"IC_kwDOHCfdf85AIMPx","bodyHTML":"<p dir=\"auto\">å…ˆçœ‹ä¸€ä¸ªä¾‹å­ï¼šå¼¥è¡¥ Promise.all ä¸æŒ‰é¡ºåºæ‰§è¡Œï¼Œå› æ­¤æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœå°±æ˜¯ï¼šæŒ‰é¡ºåºæ‰§è¡Œçš„ä¸²è¡Œè¯·æ±‚é˜Ÿåˆ—ï¼›</p>\n<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"(() =&gt; {\n  // è¯¥ä¾‹å­æ˜¯å¼¥è¡¥ Promise.all ä¸æŒ‰é¡ºåºæ‰§è¡Œ\n  console.log('æ‰§è¡Œäº† sequenceTasksWithPromise')\n\n  const createEvent = () =&gt; {\n    return new Promise((resolve, reject) =&gt; {\n      setTimeout(() =&gt; {\n        console.log('æ‰§è¡Œäº†ä¸€æ¬¡ createEvent, time :', new Date().getTime())\n        resolve(1)\n      }, 2000)\n    })\n  }\n  const tasks = [createEvent, createEvent, createEvent];\n  // ç¬¬ä¸€æ¬¡ Promise.resolve()ï¼Œä»–è¡¨ç¤ºä¸€ä¸ªåŠ¨ä½œå·²ç»æ‰§è¡Œå®Œæˆ\n  // å¼€å§‹æ­£å¼æ‰§è¡Œ\n  // ç¬¬ä¸€ prev.then(() =&gt; next()   æ­¤åˆ»çš„ prev == Promise.resolve() è¿”å›çš„æ˜¯ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œæ‰§è¡Œthen ï¼Œæ­¤åˆ»çš„ next() == ç¬¬ä¸€ä¸ª createEvent\n  // å½“ç¬¬ä¸€ä¸ªcreateEventæ‰§è¡ŒæˆåŠŸresolveï¼Œ prev.then(() =&gt; next()ï¼Œ æ­¤åˆ» prev == ç¬¬ä¸€ä¸ªcreateEventè¿”å›çš„promise æ‰§è¡Œå®ƒçš„thenï¼Œæ­¤åˆ»çš„ next() == ç¬¬äºŒä¸ª createEvent\n  // å½“ç¬¬äºŒä¸ªcreateEventæ‰§è¡ŒæˆåŠŸresolveï¼Œprev.then(() =&gt; next()ï¼Œ æ­¤åˆ» prev == ç¬¬äºŒä¸ªcreateEventè¿”å›çš„promise æ‰§è¡Œå®ƒçš„thenï¼Œæ­¤åˆ»çš„ next() == ç¬¬ä¸‰ä¸ª createEvent\n  // å½“ç¬¬ä¸‰ä¸ªcreateEventæ‰§è¡ŒæˆåŠŸresolve å¾ªç¯ç»“æŸï¼Œè¿”å›ä¸€ä¸ªpromiseï¼Œ å°±æ˜¯ doTasks\n  const doTasks = tasks.reduce((prev, next) =&gt; prev.then(() =&gt; next()), Promise.resolve());\n\n  doTasks.then(res =&gt; {\n    console.log(res);\n  })\n\n})();\"><pre class=\"notranslate\"><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-c\">// è¯¥ä¾‹å­æ˜¯å¼¥è¡¥ Promise.all ä¸æŒ‰é¡ºåºæ‰§è¡Œ</span>\n  <span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'æ‰§è¡Œäº† sequenceTasksWithPromise'</span><span class=\"pl-kos\">)</span>\n\n  <span class=\"pl-k\">const</span> <span class=\"pl-en\">createEvent</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-k\">return</span> <span class=\"pl-k\">new</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">resolve</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">reject</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-en\">setTimeout</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'æ‰§è¡Œäº†ä¸€æ¬¡ createEvent, time :'</span><span class=\"pl-kos\">,</span> <span class=\"pl-k\">new</span> <span class=\"pl-v\">Date</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">getTime</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n        <span class=\"pl-s1\">resolve</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">2000</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-kos\">}</span>\n  <span class=\"pl-k\">const</span> <span class=\"pl-s1\">tasks</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-en\">createEvent</span><span class=\"pl-kos\">,</span> <span class=\"pl-en\">createEvent</span><span class=\"pl-kos\">,</span> <span class=\"pl-en\">createEvent</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n  <span class=\"pl-c\">// ç¬¬ä¸€æ¬¡ Promise.resolve()ï¼Œä»–è¡¨ç¤ºä¸€ä¸ªåŠ¨ä½œå·²ç»æ‰§è¡Œå®Œæˆ</span>\n  <span class=\"pl-c\">// å¼€å§‹æ­£å¼æ‰§è¡Œ</span>\n  <span class=\"pl-c\">// ç¬¬ä¸€ prev.then(() =&gt; next()   æ­¤åˆ»çš„ prev == Promise.resolve() è¿”å›çš„æ˜¯ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œæ‰§è¡Œthen ï¼Œæ­¤åˆ»çš„ next() == ç¬¬ä¸€ä¸ª createEvent</span>\n  <span class=\"pl-c\">// å½“ç¬¬ä¸€ä¸ªcreateEventæ‰§è¡ŒæˆåŠŸresolveï¼Œ prev.then(() =&gt; next()ï¼Œ æ­¤åˆ» prev == ç¬¬ä¸€ä¸ªcreateEventè¿”å›çš„promise æ‰§è¡Œå®ƒçš„thenï¼Œæ­¤åˆ»çš„ next() == ç¬¬äºŒä¸ª createEvent</span>\n  <span class=\"pl-c\">// å½“ç¬¬äºŒä¸ªcreateEventæ‰§è¡ŒæˆåŠŸresolveï¼Œprev.then(() =&gt; next()ï¼Œ æ­¤åˆ» prev == ç¬¬äºŒä¸ªcreateEventè¿”å›çš„promise æ‰§è¡Œå®ƒçš„thenï¼Œæ­¤åˆ»çš„ next() == ç¬¬ä¸‰ä¸ª createEvent</span>\n  <span class=\"pl-c\">// å½“ç¬¬ä¸‰ä¸ªcreateEventæ‰§è¡ŒæˆåŠŸresolve å¾ªç¯ç»“æŸï¼Œè¿”å›ä¸€ä¸ªpromiseï¼Œ å°±æ˜¯ doTasks</span>\n  <span class=\"pl-k\">const</span> <span class=\"pl-s1\">doTasks</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">tasks</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">reduce</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">prev</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">next</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s1\">prev</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">then</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s1\">next</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">resolve</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n\n  <span class=\"pl-s1\">doTasks</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">then</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">res</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">res</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n  <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span></pre></div>\n<p dir=\"auto\">å¦‚ä½•æ˜ç™½äº†ä¸Šé¢çš„åŸç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®ç°æˆ‘ä»¬çš„é¢˜ç›®ï¼š</p>\n<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"const ajaxArr: Ajax[] = [ajax1, ajax2, ajax4];\n\nfunction serial(ajaxArr: Ajax[]) {\n  // å®ç°...\n  ajaxArr.reduce((prev, next) =&gt; prev.then(() =&gt; next()), Promise.resolve());\n}\n\nserial(ajaxArr)\n// 1ç§’åajax1è¯·æ±‚å®Œæ¯•\n// å†è¿‡2ç§’ï¼Œajax2è¯·æ±‚å®Œæ¯•\n// å†è¿‡4ç§’ï¼Œajax4è¯·æ±‚å®Œæ¯•\n\"><pre class=\"notranslate\"><span class=\"pl-k\">const</span> <span class=\"pl-s1\">ajaxArr</span>: <span class=\"pl-v\">Ajax</span><span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-s1\">ajax1</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">ajax2</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">ajax4</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n\n<span class=\"pl-k\">function</span> <span class=\"pl-en\">serial</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">ajaxArr</span>: <span class=\"pl-v\">Ajax</span><span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-c\">// å®ç°...</span>\n  <span class=\"pl-s1\">ajaxArr</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">reduce</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">prev</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">next</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s1\">prev</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">then</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s1\">next</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">resolve</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n<span class=\"pl-kos\">}</span>\n\n<span class=\"pl-en\">serial</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">ajaxArr</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\">// 1ç§’åajax1è¯·æ±‚å®Œæ¯•</span>\n<span class=\"pl-c\">// å†è¿‡2ç§’ï¼Œajax2è¯·æ±‚å®Œæ¯•</span>\n<span class=\"pl-c\">// å†è¿‡4ç§’ï¼Œajax4è¯·æ±‚å®Œæ¯•</span></pre></div>","author":{"login":"supermanklk","avatarUrl":"https://avatars.githubusercontent.com/u/28639384?u=02c9e7b01132ff83f7ac72ffce3ea8c4e486f144&v=4","url":"https://github.com/supermanklk"},"replies":null}},{"node":{"id":"IC_kwDOHCfdf85AIcwd","bodyHTML":"<p dir=\"auto\">å…ˆè¯´ä¸€ä¸‹è®¾è®¡çš„æ€è·¯ï¼š</p>\n<ol dir=\"auto\">\n<li>å¼‚æ­¥é€‰æ‹©ä¸²è¡Œï¼Œé‚£ä¹ˆå¯èƒ½æœ‰å€¼ä¼ é€’çš„éœ€æ±‚</li>\n<li>è€ƒè™‘åˆ°æˆåŠŸå’Œå¤±è´¥çš„åœºæ™¯ï¼Œé‚£ä¹ˆæä¾›ä¸­æ–­å’Œç»§ç»­çš„èƒ½åŠ›</li>\n<li>æ•´æ¡é“¾è·¯å®Œæˆåè¿”å›Promiseå¯ä»¥è¿›ä¸€æ­¥æ‹“å±•èƒ½åŠ›</li>\n</ol>\n<p dir=\"auto\">å®ç°</p>\n<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"    async function serial(list, errHandler) {\n      let response = null;\n      for (const task of list) {\n        try {\n          response = await task(response)\n        } catch (e) {\n          if (typeof errHandler !== &quot;function&quot;) {\n            throw e\n          }\n          if (!await errHandler(e, task, response)) {\n            break\n          }\n        }\n      }\n      return response\n    }\"><pre class=\"notranslate\">    <span class=\"pl-k\">async</span> <span class=\"pl-k\">function</span> <span class=\"pl-en\">serial</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">list</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">errHandler</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-k\">let</span> <span class=\"pl-s1\">response</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">null</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-k\">for</span> <span class=\"pl-kos\">(</span><span class=\"pl-k\">const</span> <span class=\"pl-s1\">task</span> <span class=\"pl-k\">of</span> <span class=\"pl-s1\">list</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-k\">try</span> <span class=\"pl-kos\">{</span>\n          <span class=\"pl-s1\">response</span> <span class=\"pl-c1\">=</span> <span class=\"pl-k\">await</span> <span class=\"pl-en\">task</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">response</span><span class=\"pl-kos\">)</span>\n        <span class=\"pl-kos\">}</span> <span class=\"pl-k\">catch</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">e</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n          <span class=\"pl-k\">if</span> <span class=\"pl-kos\">(</span><span class=\"pl-k\">typeof</span> <span class=\"pl-s1\">errHandler</span> <span class=\"pl-c1\">!==</span> <span class=\"pl-s\">\"function\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n            <span class=\"pl-k\">throw</span> <span class=\"pl-s1\">e</span>\n          <span class=\"pl-kos\">}</span>\n          <span class=\"pl-k\">if</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">!</span><span class=\"pl-k\">await</span> <span class=\"pl-s1\">errHandler</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">e</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">task</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">response</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n            <span class=\"pl-k\">break</span>\n          <span class=\"pl-kos\">}</span>\n        <span class=\"pl-kos\">}</span>\n      <span class=\"pl-kos\">}</span>\n      <span class=\"pl-k\">return</span> <span class=\"pl-s1\">response</span>\n    <span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\">æµ‹è¯•ï¼š</p>\n<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"    const generate = (time, succ, cb) =&gt; async params =&gt; await new Promise((resolve, reject) =&gt; {\n      setTimeout(() =&gt; {\n        succ ? resolve(cb &amp;&amp; cb(params)) : reject(cb &amp;&amp; cb(params))\n      }, time)\n    })\n\n    const list = [\n      generate(1000, true, lastRes =&gt; {\n        console.log('one, last return is: ', lastRes)\n        return { name: 'one' }\n      }),\n      generate(2000, false, lastRes =&gt; {\n        console.log('two, last return is: ', lastRes)\n        return { name: 'two' }\n      }),\n      generate(4000, true, lastRes =&gt; {\n        console.log('three, last return is: ', lastRes)\n        return { name: 'three' }\n      }),\n    ]\n\n    serial(list, (error, task, lastResponse) =&gt; {\n      console.error(error)\n      if (error) { /* do something */ }\n      if (task) {/* do someting */ }\n      return true /* continue or not  */\n    })\"><pre class=\"notranslate\">    <span class=\"pl-k\">const</span> <span class=\"pl-en\">generate</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">time</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">succ</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">cb</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-k\">async</span> <span class=\"pl-s1\">params</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-k\">await</span> <span class=\"pl-k\">new</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">resolve</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">reject</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-en\">setTimeout</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-s1\">succ</span> ? <span class=\"pl-s1\">resolve</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">cb</span> <span class=\"pl-c1\">&amp;&amp;</span> <span class=\"pl-s1\">cb</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">params</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span> : <span class=\"pl-s1\">reject</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">cb</span> <span class=\"pl-c1\">&amp;&amp;</span> <span class=\"pl-s1\">cb</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">params</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">time</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span>\n\n    <span class=\"pl-k\">const</span> <span class=\"pl-s1\">list</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span>\n      <span class=\"pl-en\">generate</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">1000</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">true</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">lastRes</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'one, last return is: '</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">lastRes</span><span class=\"pl-kos\">)</span>\n        <span class=\"pl-k\">return</span> <span class=\"pl-kos\">{</span> <span class=\"pl-c1\">name</span>: <span class=\"pl-s\">'one'</span> <span class=\"pl-kos\">}</span>\n      <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span>\n      <span class=\"pl-en\">generate</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">2000</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">false</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">lastRes</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'two, last return is: '</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">lastRes</span><span class=\"pl-kos\">)</span>\n        <span class=\"pl-k\">return</span> <span class=\"pl-kos\">{</span> <span class=\"pl-c1\">name</span>: <span class=\"pl-s\">'two'</span> <span class=\"pl-kos\">}</span>\n      <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span>\n      <span class=\"pl-en\">generate</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">4000</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">true</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">lastRes</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'three, last return is: '</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">lastRes</span><span class=\"pl-kos\">)</span>\n        <span class=\"pl-k\">return</span> <span class=\"pl-kos\">{</span> <span class=\"pl-c1\">name</span>: <span class=\"pl-s\">'three'</span> <span class=\"pl-kos\">}</span>\n      <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span>\n    <span class=\"pl-kos\">]</span>\n\n    <span class=\"pl-en\">serial</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">list</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">error</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">task</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">lastResponse</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">error</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">error</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-k\">if</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">error</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> <span class=\"pl-c\">/* do something */</span> <span class=\"pl-kos\">}</span>\n      <span class=\"pl-k\">if</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">task</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span><span class=\"pl-c\">/* do someting */</span> <span class=\"pl-kos\">}</span>\n      <span class=\"pl-k\">return</span> <span class=\"pl-c1\">true</span> <span class=\"pl-c\">/* continue or not  */</span>\n    <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span></pre></div>","author":{"login":"0753Ljuc","avatarUrl":"https://avatars.githubusercontent.com/u/59270826?u=e3f961f6debc1ef11b75f1c4af28b6c012c4ef34&v=4","url":"https://github.com/0753Ljuc"},"replies":null}},{"node":{"id":"IC_kwDOHCfdf85AIfLn","bodyHTML":"<p dir=\"auto\">// å†™ä¸€ä¸ªæ„é€ å‡½æ•°,èƒ½æ·»åŠ æ–°ä»»åŠ¡<br>\nconst createEvent = () =&gt; {<br>\nreturn new Promise((resolve, reject) =&gt; {<br>\nsetTimeout(() =&gt; {<br>\nconsole.log('æ‰§è¡Œäº†ä¸€æ¬¡ createEvent, time :', new Date().getTime())<br>\nresolve(1)<br>\n}, 1000)<br>\n})<br>\n}</p>\n<p dir=\"auto\">function Querytask(list){<br>\nthis.tasks = list<br>\nthis.res = []<br>\nthis.querying = true</p>\n<p dir=\"auto\">// é€’å½’è°ƒç”¨<br>\nthis.query = async function (){<br>\nconst current = this.tasks?.shift()<br>\nif(current){<br>\nawait current()<br>\nthis.query()<br>\nreturn<br>\n}</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"this.querying = false\"><pre class=\"notranslate\"><code class=\"notranslate\">this.querying = false\n</code></pre></div>\n<p dir=\"auto\">}<br>\n// æ·»åŠ çš„æ—¶å€™è°ƒèµ·query<br>\nthis.add = function (querylist){<br>\nthis.tasks = this.tasks.concat(querylist)</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"if(!this.querying){ \n  this.querying = true,\n  this.query()\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">if(!this.querying){ \n  this.querying = true,\n  this.query()\n}\n</code></pre></div>\n<p dir=\"auto\">}<br>\n// èµ·å§‹æ‰§è¡Œä¸€æ¬¡<br>\nthis.query()<br>\n}</p>\n<p dir=\"auto\">const tashInstance = new Querytask([createEvent, createEvent, createEvent])</p>\n<p dir=\"auto\">tashInstance.add(createEvent)<br>\ntashInstance.add(createEvent)<br>\ntashInstance.add(createEvent)</p>","author":{"login":"cloudflypeng","avatarUrl":"https://avatars.githubusercontent.com/u/44285412?u=197c85674725179445e36cd8918bbfb32a0aada2&v=4","url":"https://github.com/cloudflypeng"},"replies":null}},{"node":{"id":"IC_kwDOHCfdf85AIo9u","bodyHTML":"<p dir=\"auto\">åˆšå¥½ä»Šå¤©åœ¨çº¢å®ä¹¦é‡Œçœ‹åˆ° Symbol çš„è¿­ä»£ï¼š</p>\n<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Emitter {\n  constructor(max) {\n    this.max = max;\n    this.asyncIdx = 0;\n  }\n\n  async *[Symbol.asyncIterator]() {\n    while (this.asyncIdx &lt; this.max) {\n      yield new Promise(resolve =&gt; {\n        setTimeout(() =&gt; {\n          resolve(this.asyncIdx++);\n        }, 1000);\n      });\n    }\n  }\n}\n\n(async function asyncCount() {\n  let emitter = new Emitter(5);\n\n  for await (const x of emitter) {\n    console.log(x);\n  }\n})();\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Emitter</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-en\">constructor</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">max</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-smi\">this</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">max</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">max</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-smi\">this</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">asyncIdx</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">0</span><span class=\"pl-kos\">;</span>\n  <span class=\"pl-kos\">}</span>\n\n  <span class=\"pl-k\">async</span> <span class=\"pl-c1\">*</span><span class=\"pl-kos\">[</span><span class=\"pl-v\">Symbol</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">asyncIterator</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-k\">while</span> <span class=\"pl-kos\">(</span><span class=\"pl-smi\">this</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">asyncIdx</span> <span class=\"pl-c1\">&lt;</span> <span class=\"pl-smi\">this</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">max</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-k\">yield</span> <span class=\"pl-k\">new</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">resolve</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-en\">setTimeout</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n          <span class=\"pl-en\">resolve</span><span class=\"pl-kos\">(</span><span class=\"pl-smi\">this</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">asyncIdx</span><span class=\"pl-c1\">++</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">1000</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-kos\">}</span>\n  <span class=\"pl-kos\">}</span>\n<span class=\"pl-kos\">}</span>\n\n<span class=\"pl-kos\">(</span><span class=\"pl-k\">async</span> <span class=\"pl-k\">function</span> <span class=\"pl-en\">asyncCount</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-k\">let</span> <span class=\"pl-s1\">emitter</span> <span class=\"pl-c1\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-v\">Emitter</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">5</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n\n  <span class=\"pl-k\">for</span> <span class=\"pl-k\">await</span> <span class=\"pl-kos\">(</span><span class=\"pl-k\">const</span> <span class=\"pl-s1\">x</span> <span class=\"pl-k\">of</span> <span class=\"pl-s1\">emitter</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">x</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n  <span class=\"pl-kos\">}</span>\n<span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span></pre></div>","author":{"login":"yearth","avatarUrl":"https://avatars.githubusercontent.com/u/12742400?u=0a6e6f05ecb3b00661fd1f04b2ecce8dd4249534&v=4","url":"https://github.com/yearth"},"replies":null}},{"node":{"id":"IC_kwDOHCfdf85AIpLU","bodyHTML":"<p dir=\"auto\">å¼‚æ­¥composeå‡½æ•°</p>\n<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"const serial = function(...args) {\n  const init = args.pop()\n  return function(...arg) {\n    return args.reverse().reduce(function(sequence, func) {\n      return sequence.then(function(result) {\n        return func.call(null, result)\n      })\n    }, Promise.resolve(init.apply(null, arg)))\n  }\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">const</span> <span class=\"pl-en\">serial</span> <span class=\"pl-c1\">=</span> <span class=\"pl-k\">function</span><span class=\"pl-kos\">(</span>...<span class=\"pl-s1\">args</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-k\">const</span> <span class=\"pl-s1\">init</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">args</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">pop</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">return</span> <span class=\"pl-k\">function</span><span class=\"pl-kos\">(</span>...<span class=\"pl-s1\">arg</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">args</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">reverse</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">reduce</span><span class=\"pl-kos\">(</span><span class=\"pl-k\">function</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">sequence</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">func</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-k\">return</span> <span class=\"pl-s1\">sequence</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">then</span><span class=\"pl-kos\">(</span><span class=\"pl-k\">function</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">result</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-k\">return</span> <span class=\"pl-s1\">func</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">call</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">null</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">result</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">resolve</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">init</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">apply</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">null</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">arg</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-kos\">}</span>\n<span class=\"pl-kos\">}</span></pre></div>","author":{"login":"fishcoderman","avatarUrl":"https://avatars.githubusercontent.com/u/33595825?u=938416b85277d9b786dd5e00789ea6b2f899fb3b&v=4","url":"https://github.com/fishcoderman"},"replies":null}},{"node":{"id":"IC_kwDOHCfdf85AIsUt","bodyHTML":"<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"const runPromiseInSequence = (array, value) =&gt; {\n  return array.reduce(\n    (promiseChain, currentFunc) =&gt; promiseChain.then(currentFunc),\n    promise.resolve(value)  \n  )\n}\n\"><pre class=\"notranslate\"><span class=\"pl-k\">const</span> <span class=\"pl-en\">runPromiseInSequence</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">array</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-k\">return</span> <span class=\"pl-s1\">array</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">reduce</span><span class=\"pl-kos\">(</span>\n    <span class=\"pl-kos\">(</span><span class=\"pl-s1\">promiseChain</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">currentFunc</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s1\">promiseChain</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">then</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">currentFunc</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span>\n    <span class=\"pl-s1\">promise</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">resolve</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span>  \n  <span class=\"pl-kos\">)</span>\n<span class=\"pl-kos\">}</span></pre></div>","author":{"login":"Ha0ran2001","avatarUrl":"https://avatars.githubusercontent.com/u/73927445?u=51b77bd26b8dbe99cd4a9c86f8f5051df49626a2&v=4","url":"https://github.com/Ha0ran2001"},"replies":null}},{"node":{"id":"IC_kwDOHCfdf85AJJkc","bodyHTML":"<p dir=\"auto\">æ€æƒ³<br>\nå€Ÿé‰´reduceçš„æ€ç»´å®ç°ä¸²è¡Œæ•°æ®äº’é€š<br>\næ‹“å±•reduceä¸èƒ½æ”¯æŒå¼‚æ­¥çš„åŠŸèƒ½<br>\næç¤ºï¼šæ ¸å¿ƒä»£ç åœ¨ //=================  ä¸­é—´</p>\n<p dir=\"auto\">æ ¸å¿ƒä»£ç </p>\n<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"async function serial(queue, fn = (p, v) =&gt; [...p, v], initValue = []) {\n    return await asyncReduce(queue, fn, initValue);\n    // ä¸²è¡Œæ‰§è¡Œé˜Ÿåˆ—\n    async function asyncReduce(queue, fn, initData) {\n        let resData = initData;\n        for (let i = 0; i &lt; queue.length; i++) {\n            // ä¿è¯å¯ä»¥æ‹¿åˆ°ä¸Šæ¬¡çš„ä¸²è¡Œç»“æœresData\n            const data = await queue[i](resData).then(d =&gt; d, e =&gt; e)\n            resData = fn(resData, data)\n        }\n        return resData\n    }\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">async</span> <span class=\"pl-k\">function</span> <span class=\"pl-en\">serial</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">queue</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">fn</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">p</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">v</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">[</span>...<span class=\"pl-s1\">p</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">v</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">initValue</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-k\">return</span> <span class=\"pl-k\">await</span> <span class=\"pl-en\">asyncReduce</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">queue</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">fn</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">initValue</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-c\">// ä¸²è¡Œæ‰§è¡Œé˜Ÿåˆ—</span>\n    <span class=\"pl-k\">async</span> <span class=\"pl-k\">function</span> <span class=\"pl-en\">asyncReduce</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">queue</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">fn</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">initData</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-k\">let</span> <span class=\"pl-s1\">resData</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">initData</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-k\">for</span> <span class=\"pl-kos\">(</span><span class=\"pl-k\">let</span> <span class=\"pl-s1\">i</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">0</span><span class=\"pl-kos\">;</span> <span class=\"pl-s1\">i</span> <span class=\"pl-c1\">&lt;</span> <span class=\"pl-s1\">queue</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">length</span><span class=\"pl-kos\">;</span> <span class=\"pl-s1\">i</span><span class=\"pl-c1\">++</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n            <span class=\"pl-c\">// ä¿è¯å¯ä»¥æ‹¿åˆ°ä¸Šæ¬¡çš„ä¸²è¡Œç»“æœresData</span>\n            <span class=\"pl-k\">const</span> <span class=\"pl-s1\">data</span> <span class=\"pl-c1\">=</span> <span class=\"pl-k\">await</span> <span class=\"pl-s1\">queue</span><span class=\"pl-kos\">[</span><span class=\"pl-s1\">i</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">resData</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">then</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">d</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s1\">d</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">e</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s1\">e</span><span class=\"pl-kos\">)</span>\n            <span class=\"pl-s1\">resData</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">fn</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">resData</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">data</span><span class=\"pl-kos\">)</span>\n        <span class=\"pl-kos\">}</span>\n        <span class=\"pl-k\">return</span> <span class=\"pl-s1\">resData</span>\n    <span class=\"pl-kos\">}</span>\n<span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\">æµ‹è¯•ä»£ç </p>\n<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"// ä»»åŠ¡æ„é€ å™¨\nconst getTask = (data, delay = 500, isErro = false) =&gt; (preData) =&gt; {\n    return new Promise((resolve, reject) =&gt; {\n        setTimeout(() =&gt; {\n            console.log(data);\n            isErro ? reject(data) : resolve(data)\n        }, delay)\n    })\n}\n// åˆ›å»ºä»»åŠ¡\nconst taskQueue = [getTask(1), getTask(2, 2000, true), getTask(3)];\n\n\n/**\n * æ‰§è¡Œä»»åŠ¡å‡½æ•°\n * @param {*} queue é˜Ÿåˆ— \n * @param {*} fn æ‰©å±•æ¯æ­¥ä¹‹è¡Œåçš„fnå›è°ƒ ç”¨äºå¤„ç†è¿”å›ç»“æœ\n * @param {*} initValue ä¸²è¡Œç»“æœçš„åˆå§‹å€¼\n * @returns \n */\n\n\n// ======================================\nasync function serial(queue, fn = (p, v) =&gt; [...p, v], initValue = []) {\n    return await asyncReduce(queue, fn, initValue);\n    // ä¸²è¡Œæ‰§è¡Œé˜Ÿåˆ—\n    async function asyncReduce(queue, fn, initData) {\n        let resData = initData;\n        for (let i = 0; i &lt; queue.length; i++) {\n            // ä¿è¯å¯ä»¥æ‹¿åˆ°ä¸Šæ¬¡çš„ä¸²è¡Œç»“æœresData\n            const data = await queue[i](resData).then(d =&gt; d, e =&gt; e)\n            resData = fn(resData, data)\n        }\n        return resData\n    }\n}\n// ======================================\n\nconsole.log('------æµ‹è¯•Demo1------')\nserial(taskQueue).then(console.log)\n\n// ä¸‹é¢æ˜¯æµ‹è¯•Demo\n// demo æ¯”å¦‚æˆ‘ä»¬æœ¬æ¬¡éœ€è¦è·å–ä¸Šæ¬¡ä»»åŠ¡çš„è¯·æ±‚ç»“æœå¹¶è¿›è¡Œç›¸åŠ \nconst demoRequest = (data) =&gt; (preData) =&gt; new Promise(resolve =&gt; setTimeout(() =&gt; {\n    console.log(`ä¸Šæ¬¡è¯·æ±‚çš„æ•°æ®${preData},æœ¬æ¬¡çš„æ•°æ®${data}, è¿”å›çš„æ•°æ®${preData + data}`)\n    resolve(data)\n}, 500))\nconst demoTask = [demoRequest(1), demoRequest(2), demoRequest(3)];\nsetTimeout(() =&gt; {\n    console.log('------æµ‹è¯•Demo2------');\n    serial(demoTask, (p, v) =&gt; p + v, 0).then(console.log)\n}, 5000)\"><pre class=\"notranslate\"><span class=\"pl-c\">// ä»»åŠ¡æ„é€ å™¨</span>\n<span class=\"pl-k\">const</span> <span class=\"pl-en\">getTask</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">data</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">delay</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">500</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">isErro</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">false</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">preData</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-k\">return</span> <span class=\"pl-k\">new</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">resolve</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">reject</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-en\">setTimeout</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n            <span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">data</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n            <span class=\"pl-s1\">isErro</span> ? <span class=\"pl-s1\">reject</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">data</span><span class=\"pl-kos\">)</span> : <span class=\"pl-s1\">resolve</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">data</span><span class=\"pl-kos\">)</span>\n        <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">delay</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-kos\">}</span>\n<span class=\"pl-c\">// åˆ›å»ºä»»åŠ¡</span>\n<span class=\"pl-k\">const</span> <span class=\"pl-s1\">taskQueue</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-en\">getTask</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-en\">getTask</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">2</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">2000</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">true</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-en\">getTask</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">3</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n\n\n<span class=\"pl-c\">/**</span>\n<span class=\"pl-c\"> * æ‰§è¡Œä»»åŠ¡å‡½æ•°</span>\n<span class=\"pl-c\"> * <span class=\"pl-k\">@param</span> {<span class=\"pl-smi\">*</span>} queue é˜Ÿåˆ— </span>\n<span class=\"pl-c\"> * <span class=\"pl-k\">@param</span> {<span class=\"pl-smi\">*</span>} fn æ‰©å±•æ¯æ­¥ä¹‹è¡Œåçš„fnå›è°ƒ ç”¨äºå¤„ç†è¿”å›ç»“æœ</span>\n<span class=\"pl-c\"> * <span class=\"pl-k\">@param</span> {<span class=\"pl-smi\">*</span>} initValue ä¸²è¡Œç»“æœçš„åˆå§‹å€¼</span>\n<span class=\"pl-c\"> * <span class=\"pl-k\">@returns</span> </span>\n<span class=\"pl-c\"> */</span>\n\n\n<span class=\"pl-c\">// ======================================</span>\n<span class=\"pl-k\">async</span> <span class=\"pl-k\">function</span> <span class=\"pl-en\">serial</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">queue</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">fn</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">p</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">v</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">[</span>...<span class=\"pl-s1\">p</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">v</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">initValue</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-k\">return</span> <span class=\"pl-k\">await</span> <span class=\"pl-en\">asyncReduce</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">queue</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">fn</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">initValue</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-c\">// ä¸²è¡Œæ‰§è¡Œé˜Ÿåˆ—</span>\n    <span class=\"pl-k\">async</span> <span class=\"pl-k\">function</span> <span class=\"pl-en\">asyncReduce</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">queue</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">fn</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">initData</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-k\">let</span> <span class=\"pl-s1\">resData</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">initData</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-k\">for</span> <span class=\"pl-kos\">(</span><span class=\"pl-k\">let</span> <span class=\"pl-s1\">i</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">0</span><span class=\"pl-kos\">;</span> <span class=\"pl-s1\">i</span> <span class=\"pl-c1\">&lt;</span> <span class=\"pl-s1\">queue</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">length</span><span class=\"pl-kos\">;</span> <span class=\"pl-s1\">i</span><span class=\"pl-c1\">++</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n            <span class=\"pl-c\">// ä¿è¯å¯ä»¥æ‹¿åˆ°ä¸Šæ¬¡çš„ä¸²è¡Œç»“æœresData</span>\n            <span class=\"pl-k\">const</span> <span class=\"pl-s1\">data</span> <span class=\"pl-c1\">=</span> <span class=\"pl-k\">await</span> <span class=\"pl-s1\">queue</span><span class=\"pl-kos\">[</span><span class=\"pl-s1\">i</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">resData</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">then</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">d</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s1\">d</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">e</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s1\">e</span><span class=\"pl-kos\">)</span>\n            <span class=\"pl-s1\">resData</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">fn</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">resData</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">data</span><span class=\"pl-kos\">)</span>\n        <span class=\"pl-kos\">}</span>\n        <span class=\"pl-k\">return</span> <span class=\"pl-s1\">resData</span>\n    <span class=\"pl-kos\">}</span>\n<span class=\"pl-kos\">}</span>\n<span class=\"pl-c\">// ======================================</span>\n\n<span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'------æµ‹è¯•Demo1------'</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-en\">serial</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">taskQueue</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">then</span><span class=\"pl-kos\">(</span><span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">log</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-c\">// ä¸‹é¢æ˜¯æµ‹è¯•Demo</span>\n<span class=\"pl-c\">// demo æ¯”å¦‚æˆ‘ä»¬æœ¬æ¬¡éœ€è¦è·å–ä¸Šæ¬¡ä»»åŠ¡çš„è¯·æ±‚ç»“æœå¹¶è¿›è¡Œç›¸åŠ </span>\n<span class=\"pl-k\">const</span> <span class=\"pl-en\">demoRequest</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">data</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">preData</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-k\">new</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">resolve</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-en\">setTimeout</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">`ä¸Šæ¬¡è¯·æ±‚çš„æ•°æ®<span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">preData</span><span class=\"pl-kos\">}</span></span>,æœ¬æ¬¡çš„æ•°æ®<span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">data</span><span class=\"pl-kos\">}</span></span>, è¿”å›çš„æ•°æ®<span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">preData</span> <span class=\"pl-c1\">+</span> <span class=\"pl-s1\">data</span><span class=\"pl-kos\">}</span></span>`</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-en\">resolve</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">data</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">500</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-k\">const</span> <span class=\"pl-s1\">demoTask</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-en\">demoRequest</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-en\">demoRequest</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">2</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-en\">demoRequest</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">3</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n<span class=\"pl-en\">setTimeout</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'------æµ‹è¯•Demo2------'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-en\">serial</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">demoTask</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">p</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">v</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s1\">p</span> <span class=\"pl-c1\">+</span> <span class=\"pl-s1\">v</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">0</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">then</span><span class=\"pl-kos\">(</span><span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">log</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">5000</span><span class=\"pl-kos\">)</span></pre></div>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/81680241/159680119-d00f11b9-fba0-46c0-a801-09bdf1339e0c.png\"><img width=\"305\" alt=\"image\" src=\"https://user-images.githubusercontent.com/81680241/159680119-d00f11b9-fba0-46c0-a801-09bdf1339e0c.png\" style=\"max-width: 100%;\"></a></p>","author":{"login":"codingJJJ","avatarUrl":"https://avatars.githubusercontent.com/u/81680241?u=ea1e86c5699c8a80d8cde9e6e7afc1042024bc68&v=4","url":"https://github.com/codingJJJ"},"replies":null}},{"node":{"id":"IC_kwDOHCfdf85AKAk_","bodyHTML":"<p dir=\"auto\">æœ¬æ¥è¿™ä¸ªæ–¹æ³•æ˜¯å†™ç»™å¹¶è¡Œè¯·æ±‚çš„ï¼Œä½†å°†å¹¶å‘å‚æ•°è®¾ç½®ä¸º 1 å³å¯å®ç°ä¸²è¡Œè¯·æ±‚<br>\nåŸç† promise ä¸ºpending æ—¶ä¼šé˜»å¡ä»£ç è¿è¡Œ</p>\n<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"function limitParallel(lists = [], limit = 1) {\n  let cur = 0;\n  let pending = [];\n  let res = [];\n  let done = 0;\n\n  async function add(f, i, allResolve) {\n    if (cur &gt;= limit) {\n      // promise ä¸ºpending æ—¶ä¼šé˜»å¡ä»£ç è¿è¡Œ\n      await new Promise((res1, rej1) =&gt; {\n        pending.push(res1);\n      });\n    }\n    cur++;\n    let temp = await f();\n    done++;\n    cur--;\n    if (pending.length &gt; 0) {\n      pending.shift()();\n    }\n    res[i] = temp;\n    if (done === lists.length) {\n      allResolve(res);\n    }\n  }\n\n  return new Promise(async (resolve, reject) =&gt; {\n    lists.forEach((f, i) =&gt; {\n      add(f, i, resolve)\n    });\n  })\n}\n\nfunction genPromise(i) {\n  return new Promise((resolve, reject) =&gt; {\n    setTimeout(() =&gt; {\n      resolve(`${i}${i}`)\n    }, Math.random() * 1000);\n  });\n}\nlimitParallel(Array.from({length: 10}, (_, i) =&gt; {\n   return genPromise.bind(null, i)\n}), 1).then(console.log);\"><pre class=\"notranslate\"><span class=\"pl-k\">function</span> <span class=\"pl-en\">limitParallel</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">lists</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">limit</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-k\">let</span> <span class=\"pl-s1\">cur</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">0</span><span class=\"pl-kos\">;</span>\n  <span class=\"pl-k\">let</span> <span class=\"pl-s1\">pending</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n  <span class=\"pl-k\">let</span> <span class=\"pl-s1\">res</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">;</span>\n  <span class=\"pl-k\">let</span> <span class=\"pl-s1\">done</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">0</span><span class=\"pl-kos\">;</span>\n\n  <span class=\"pl-k\">async</span> <span class=\"pl-k\">function</span> <span class=\"pl-en\">add</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">f</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">i</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">allResolve</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-k\">if</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">cur</span> <span class=\"pl-c1\">&gt;=</span> <span class=\"pl-s1\">limit</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-c\">// promise ä¸ºpending æ—¶ä¼šé˜»å¡ä»£ç è¿è¡Œ</span>\n      <span class=\"pl-k\">await</span> <span class=\"pl-k\">new</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">res1</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">rej1</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-s1\">pending</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">push</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">res1</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-kos\">}</span>\n    <span class=\"pl-s1\">cur</span><span class=\"pl-c1\">++</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-k\">let</span> <span class=\"pl-s1\">temp</span> <span class=\"pl-c1\">=</span> <span class=\"pl-k\">await</span> <span class=\"pl-s1\">f</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-s1\">done</span><span class=\"pl-c1\">++</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-s1\">cur</span><span class=\"pl-c1\">--</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-k\">if</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">pending</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">length</span> <span class=\"pl-c1\">&gt;</span> <span class=\"pl-c1\">0</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-s1\">pending</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">shift</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-kos\">}</span>\n    <span class=\"pl-s1\">res</span><span class=\"pl-kos\">[</span><span class=\"pl-s1\">i</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">temp</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-k\">if</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">done</span> <span class=\"pl-c1\">===</span> <span class=\"pl-s1\">lists</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">length</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-s1\">allResolve</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">res</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n    <span class=\"pl-kos\">}</span>\n  <span class=\"pl-kos\">}</span>\n\n  <span class=\"pl-k\">return</span> <span class=\"pl-k\">new</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">(</span><span class=\"pl-k\">async</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">resolve</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">reject</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-s1\">lists</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">forEach</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">f</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">i</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-en\">add</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">f</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">i</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">resolve</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n  <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-kos\">}</span>\n\n<span class=\"pl-k\">function</span> <span class=\"pl-en\">genPromise</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">i</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-k\">return</span> <span class=\"pl-k\">new</span> <span class=\"pl-v\">Promise</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">resolve</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">reject</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-en\">setTimeout</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-s1\">resolve</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">`<span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">i</span><span class=\"pl-kos\">}</span></span><span class=\"pl-s1\"><span class=\"pl-kos\">${</span><span class=\"pl-s1\">i</span><span class=\"pl-kos\">}</span></span>`</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">Math</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">random</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">*</span> <span class=\"pl-c1\">1000</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n  <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n<span class=\"pl-kos\">}</span>\n<span class=\"pl-en\">limitParallel</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Array</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">from</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">{</span><span class=\"pl-c1\">length</span>: <span class=\"pl-c1\">10</span><span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">_</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">i</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n   <span class=\"pl-k\">return</span> <span class=\"pl-s1\">genPromise</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">bind</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">null</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">i</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">then</span><span class=\"pl-kos\">(</span><span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">log</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span></pre></div>\n<p dir=\"auto\">æ‰“å°ç»“æœ<br>\n<a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/17136707/159708271-44604201-0a01-4e86-a5f6-5aad6eb20eb9.png\"><img src=\"https://user-images.githubusercontent.com/17136707/159708271-44604201-0a01-4e86-a5f6-5aad6eb20eb9.png\" alt=\"image\" style=\"max-width: 100%;\"></a></p>","author":{"login":"fanerge","avatarUrl":"https://avatars.githubusercontent.com/u/17136707?u=d7250b0655c87b8e8e1cdaf826754fe5e6f68e80&v=4","url":"https://github.com/fanerge"},"replies":null}},{"node":{"id":"IC_kwDOHCfdf85AOFBR","bodyHTML":"<p dir=\"auto\">è¿™æ ·æ˜¯ä¸æ˜¯çœ‹èµ·æ¥æ›´ç®€æ´</p>\n<blockquote>\n<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"function async serial(ajaxArr) {\n for (const i of ajaxArr) {\n     await i()\n }\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">function</span> <span class=\"pl-s1\">async</span> <span class=\"pl-en\">serial</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">ajaxArr</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n <span class=\"pl-k\">for</span> <span class=\"pl-kos\">(</span><span class=\"pl-k\">const</span> <span class=\"pl-s1\">i</span> <span class=\"pl-k\">of</span> <span class=\"pl-s1\">ajaxArr</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n     <span class=\"pl-k\">await</span> <span class=\"pl-en\">i</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span>\n <span class=\"pl-kos\">}</span>\n<span class=\"pl-kos\">}</span></pre></div>\n</blockquote>","author":{"login":"Marcowutt","avatarUrl":"https://avatars.githubusercontent.com/u/33864252?v=4","url":"https://github.com/Marcowutt"},"replies":null}}]}}},"pageContext":{"number":6,"previous":{"title":"å¦‚ä½•åº”å¯¹äº§å“ç»ç†ä¸­é€”æ”¹éœ€æ±‚ï¼Ÿ","number":5},"next":{"title":"é‡åˆ°çº¿ä¸Šbugè¯¥å¦‚ä½•å¤„ç†ï¼Ÿ","number":8}}},
    "staticQueryHashes": ["151096407","2861350382"]}